<script src="/authproxy/loginpage/bower_components/jquery/dist/jquery.min.js"></script>
<script src="/authproxy/loginpage/bower_components/js-cookie/src/js.cookie.js"/></script>
<title>Login</title>
<script>
	var authTokenCookieName = 'AuthProxyToken';
	
	function usernameField() {
		return $('#username');
	}

	function passwordField() {
		return $('#password');
	}

	function loginField() {
		return $('#login');
	}

	$(document).ready(function() {
		loginField().click(login);

		usernameField().on('input', updateLoginFieldState);
		passwordField().on('input', updateLoginFieldState);
		updateLoginFieldState();
	});

	function updateLoginFieldState() {
		if (usernameField().val() && passwordField().val()) {
			loginField().removeAttr('disabled');
		} else {
			loginField().attr('disabled', 'disabled');
		}
	}

	function login() {
		var username = usernameField().val();
		var password = passwordField().val();

		console.log('username: ' + username);
		console.log('password: ' + password);

		// Make a login request.

		$.ajax('/authproxy/login', {
			method: 'post',
			dataType: 'json',
			contentType: 'application/json',
			success: function(token) {
				// Set the token as a cookie.
					// Cookies are used because these will be sent will be sent with all requests without any change to the proxied application.
					// TODO: Set the correct expiry date.
				Cookies.set(authTokenCookieName, token.token);

				// Login successful.
					// TODO: Show a message about successful login until the page reloads?

				// Reload the page so the user will be let through using their cookie.
				location.reload();
			},
			fail: function() {
				console.log('failed');

				// TODO: Display a failure message.
			},
			data: JSON.stringify({
				username : usernameField().val(),
				password : passwordField().val()
			})
		});
	}
</script>

<body>
	Login page!

	<input id="username" type="text" placeholder="Username">
	<input id="password" type="password" placeholder="Password">
	<input id="login" type="button" value="Login">
</body>

